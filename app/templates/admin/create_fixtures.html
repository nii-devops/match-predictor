{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h2><i class="fas fa-plus"></i> Create Match Week</h2>
        <p class="text-muted">Set up a new match week with fixtures</p>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <form method="POST" action="" id="fixtures-form">
            {{ matchweek_form.hidden_tag() }}
            
            <div class="card mb-4">
                <div class="card-body">
                    <h5 class="card-title">Match Week Details</h5>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            {{ matchweek_form.season.label(class="form-label") }}
                            {{ matchweek_form.season(class="form-control", placeholder="Select Season") }}
                            {% if matchweek_form.season.errors %}
                                <div class="text-danger">{{ matchweek_form.season.errors[0] }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-6 mb-3">
                            {{ matchweek_form.week_number.label(class="form-label") }}
                            {{ matchweek_form.week_number(class="form-control", placeholder="Enter Week Number") }}
                            {% if matchweek_form.week_number.errors %}
                                <div class="text-danger">{{ matchweek_form.week_number.errors[0] }}</div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            {{ matchweek_form.predictions_open_time.label(class="form-label") }}
                            {{ matchweek_form.predictions_open_time(class="form-control", type="datetime-local") }}
                            {% if matchweek_form.predictions_open_time.errors %}
                                <div class="text-danger">{{ matchweek_form.predictions_open_time.errors[0] }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-6 mb-3">
                            {{ matchweek_form.predictions_close_time.label(class="form-label") }}
                            {{ matchweek_form.predictions_close_time(class="form-control", type="datetime-local") }}
                            {% if matchweek_form.predictions_close_time.errors %}
                                <div class="text-danger">{{ matchweek_form.predictions_close_time.errors[0] }}</div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="fixtures-list" class="card mb-4">
                <div class="card-body">
                    
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="card-title mb-0">Fixtures</h5>
                        <button type="button" class="btn btn-outline-primary btn-sm" id="add-fixture-btn" onclick="addFixture()">
                            <i class="fas fa-plus"></i> Add Fixture
                        </button>
                    </div>
                    
                    <div class="form-group fixture-list">
                        <div class="row fixture-pair border rounded align-items-center mx-3 px-3 py-2 my-2" data-index="0">
                            <div class="col-md-4 col-sm-4">
                                <div class="form-group">
                                    {{ fixture_form.home_team.label(class="form-label") }}
                                    {{ fixture_form.home_team(class="form-control", id="home_team-0") }}
                                </div>
                            </div>
                            <div class="col-md-2 text-center">
                                <strong>vs</strong>
                            </div>
                            <div class="col-md-4 col-sm-4">
                                <div class="form-group">
                                    {{ fixture_form.away_team.label(class="form-label") }}
                                    {{ fixture_form.away_team(class="form-control", id="away_team-0") }}
                                </div>
                            </div>
                            <div class="col-md-2">
                                <button type="button" class="btn btn-outline-danger btn-sm remove-fixture-btn" >
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        
                    </div>
                </div>
            </div>
            
            <div class="text-end d-flex justify-content-center">
                <div>
                    <a href="{{ url_for('main.admin_dashboard') }}" class="btn btn-secondary me-2">Cancel</a>
                </div>
                
                <div>
                    <button type="submit" class="btn btn-primary">Submit</button>
                </div>
            </div>
        </form>
    </div>
</div>
{% endblock %}




{% block scripts %}

<script>
    let fixtureIndex = 1;
    
    // Fix the name attributes of the first pair on page load
    window.addEventListener('DOMContentLoaded', function() {
        const firstPair = document.querySelector('.fixture-pair');
        if (firstPair) {
            const selects = firstPair.querySelectorAll('select');
            if (selects.length >= 2) {
                selects[0].setAttribute('name', 'home_team-0');
                selects[1].setAttribute('name', 'away_team-0');
            }
        }
    });
    
    document.getElementById('add-fixture-btn').addEventListener('click', function() {
        const fixturesList = document.getElementById('fixtures-list');
        const firstPair = fixturesList.querySelector('.fixture-pair');
        const newPair = firstPair.cloneNode(true);
    
        // Update names and values
        newPair.setAttribute('data-index', fixtureIndex);
        const selects = newPair.querySelectorAll('select');
        if (selects.length >= 2) {
            selects[0].setAttribute('name', 'home_team-' + fixtureIndex);
            selects[0].selectedIndex = 0;
            selects[1].setAttribute('name', 'away_team-' + fixtureIndex);
            selects[1].selectedIndex = 0;
        }
    
        // Show remove button
        const removeBtn = newPair.querySelector('.remove-fixture-btn');
        removeBtn.style.display = 'inline-block';
        removeBtn.onclick = function() {
            newPair.remove();
        };
    
        fixturesList.appendChild(newPair);
        fixtureIndex++;
    });
    </script>
    {% endblock %}
    
    